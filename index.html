<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🌦 Fun India Weather App - Tech Version</title>
<style>
body {
  margin: 0;
  font-family: 'Comic Sans MS', cursive, sans-serif;
  transition: background 1s ease;
  color: #fff;
}

/* Dynamic Weather Backgrounds */
body.sunny { background: linear-gradient(to top, #fceabb, #f8b500); }
body.rainy { background: linear-gradient(to top, #4e54c8, #8f94fb); }
body.cloudy { background: linear-gradient(to top, #d7d2cc, #304352); }
body.snowy { background: linear-gradient(to top, #e0eafc, #cfdef3); }
body.default { background: linear-gradient(135deg, #ff9a9e, #fad0c4, #a18cd1, #fbc2eb); }

.container {
  max-width: 950px;
  margin: 20px auto;
  padding: 25px 30px;
  background: rgba(0,0,0,0.7);
  border-radius: 25px;
  box-shadow: 0 15px 30px rgba(0,0,0,0.5);
  text-align: center;
}

h1 {
  margin-bottom: 25px;
  color: #0ff;
  text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
  font-size: 2.2em;
}

select, button, input {
  padding: 12px 15px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
  margin: 5px;
  cursor: pointer;
}

button {
  background: #0ff;
  color: #000;
  font-weight: bold;
  transition: 0.3s;
}
button:hover {
  background: #06c;
  color: #fff;
  transform: scale(1.05);
}

.weather-card {
  background: rgba(0,0,0,0.5);
  margin: 15px 0;
  padding: 15px 20px;
  border-radius: 20px;
  text-align: left;
  backdrop-filter: blur(5px);
  transition: transform 0.3s, box-shadow 0.3s;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 16px;
}
.weather-card:hover {
  transform: translateY(-5px) rotate(-1deg);
  box-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
  border: 1px solid #0ff;
}

.favorites div {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #0ff;
  color: #000;
  padding: 8px 15px;
  margin: 5px;
  border-radius: 15px;
  font-weight: bold;
  transition: 0.3s;
}

.favorites div:hover {
  background: #06c;
  color: #fff;
  box-shadow: 0 0 15px #0ff;
}

.remove-btn {
  background: rgba(255,255,255,0.3);
  padding: 3px 7px;
  border-radius: 10px;
  font-size: 12px;
  cursor: pointer;
}
.remove-btn:hover {
  background: rgba(255,255,255,0.6);
}

.emoji {
  font-size: 36px;
  margin-left: 10px;
  transition: transform 0.5s;
}
.emoji.spin { transform: rotate(20deg); }

@media(max-width:600px){
  .weather-card { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body class="default">
<div class="container">
  <h1>🌦 Fun India Weather App - Tech Version</h1>

  <div>
    <select id="stateSelect">
      <option value="">Select your crazy city/state 🌆</option>
      <option value="Delhi">Delhi – The Capital</option>
      <option value="Mumbai">Mumbai – City of Dreams</option>
      <option value="Bengaluru">Bengaluru – Silicon Valley India</option>
      <option value="Chennai">Chennai – Hot & Spicy!</option>
      <option value="Kolkata">Kolkata – City of Joy</option>
      <option value="Hyderabad">Hyderabad – Biryani Land</option>
      <option value="Jaipur">Jaipur – Pink City</option>
      <option value="Lucknow">Lucknow – Nawabi Vibes</option>
      <option value="Bhopal">Bhopal – Lake City</option>
      <option value="Guwahati">Guwahati – Tea Capital</option>
      <option value="Patna">Patna – Old & Gold</option>
      <option value="Ahmedabad">Ahmedabad – Kite City</option>
      <option value="Pune">Pune – Oxford of East</option>
      <option value="Surat">Surat – Diamond Hub</option>
      <option value="Indore">Indore – Foodie Heaven</option>
      <option value="Dehradun">Dehradun – Nature Lovers</option>
      <option value="Shimla">Shimla – Hill Station Cool</option>
    </select>

    <input type="date" id="dateInput" />
    <button id="searchBtn">Search</button>
    <button id="autoLocBtn">Use My Location 🚀</button>
    <button id="stopVoiceBtn">Stop Voice 🔇</button>
  </div>

  <div id="currentWeather"></div>
  <h2>5-Day Forecast 🌤</h2>
  <div id="forecast"></div>
  <h2>Favorites ❤️</h2>
  <div class="favorites" id="favorites"></div>
</div>

<script>
const apiKey = '306a789c4407e163c1e1d2af6a0d1bb4';
const stateSelect = document.getElementById('stateSelect');
const dateInput = document.getElementById('dateInput');
const searchBtn = document.getElementById('searchBtn');
const autoLocBtn = document.getElementById('autoLocBtn');
const stopVoiceBtn = document.getElementById('stopVoiceBtn');
const currentWeatherDiv = document.getElementById('currentWeather');
const forecastDiv = document.getElementById('forecast');
const favoritesDiv = document.getElementById('favorites');

let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

const stateLogos = {
  "Delhi": "🕌",
  "Mumbai": "🏙️",
  "Bengaluru": "💻",
  "Chennai": "🌶️",
  "Kolkata": "🎨",
  "Hyderabad": "🍛",
  "Jaipur": "🏰",
  "Lucknow": "👑",
  "Bhopal": "🌊",
  "Guwahati": "🍵",
  "Patna": "📜",
  "Ahmedabad": "🪁",
  "Pune": "🎓",
  "Surat": "💎",
  "Indore": "🍴",
  "Dehradun": "🌲",
  "Shimla": "🏔️"
};

function speak(text){
  if('speechSynthesis' in window){
    window.speechSynthesis.cancel(); // cancel previous voice if still running
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 1;
    window.speechSynthesis.speak(utterance);
  }
}

function stopVoice(){
  if('speechSynthesis' in window){
    window.speechSynthesis.cancel();
  }
}

function showFavorites(){
  favoritesDiv.innerHTML = '';
  favorites.forEach(city=>{
    let div = document.createElement('div');
    div.innerHTML = `<span>${city}</span><span class="remove-btn">✖</span>`;
    div.onclick = (e)=>{
      if(e.target.classList.contains('remove-btn')){
        removeFavorite(city);
      } else {
        fetchWeather(city);
      }
    };
    favoritesDiv.appendChild(div);
  });
}

function removeFavorite(city){
  favorites = favorites.filter(c=>c!==city);
  localStorage.setItem('favorites', JSON.stringify(favorites));
  showFavorites();
}

function getWeatherEmoji(desc){
  desc = desc.toLowerCase();
  if(desc.includes('rain')) return '🌧️';
  if(desc.includes('cloud')) return '☁️';
  if(desc.includes('sun') || desc.includes('clear')) return '☀️';
  if(desc.includes('snow')) return '❄️';
  return '🌈';
}

function setBackground(desc){
  desc = desc.toLowerCase();
  const body = document.body;
  body.className = '';
  if(desc.includes('rain')) body.classList.add('rainy');
  else if(desc.includes('cloud')) body.classList.add('cloudy');
  else if(desc.includes('sun') || desc.includes('clear')) body.classList.add('sunny');
  else if(desc.includes('snow')) body.classList.add('snowy');
  else body.classList.add('default');
}

async function fetchWeather(city){
  try {
    let res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`);
    let data = await res.json();
    if(data.cod != 200) throw new Error(data.message);

    let emoji = getWeatherEmoji(data.weather[0].description);
    setBackground(data.weather[0].description);
    let logo = stateLogos[data.name] || "🏙️";

    const weatherText = `${data.name}, ${data.sys.country}. Temperature is ${data.main.temp} degrees Celsius. Humidity is ${data.main.humidity} percent. Weather condition: ${data.weather[0].description}.`;

    currentWeatherDiv.innerHTML = `
      <div class="weather-card">
        <div>
          <h2>${logo} ${data.name}, ${data.sys.country} <span class="emoji spin">${emoji}</span></h2>
          <p>Temp: ${data.main.temp} °C 🌡️</p>
          <p>Humidity: ${data.main.humidity}% 💧</p>
          <p>${data.weather[0].description} ${emoji}</p>
        </div>
        <button onclick="addFavorite('${data.name}')">Add Favorite ❤️</button>
      </div>
    `;

    speak(weatherText);

    res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`);
    let forecastData = await res.json();
    let selectedDate = dateInput.value;

    forecastDiv.innerHTML = '';
    forecastData.list.forEach(f=>{
      let fDate = f.dt_txt.split(' ')[0];
      if(!selectedDate || fDate===selectedDate){
        let e = getWeatherEmoji(f.weather[0].description);
        forecastDiv.innerHTML += `<div class="weather-card">${f.dt_txt}: ${f.main.temp} °C, ${f.weather[0].description} ${e}</div>`;
      }
    });

  } catch(err){ alert(err.message); }
}

function addFavorite(city){
  if(!favorites.includes(city)){
    favorites.push(city);
    localStorage.setItem('favorites', JSON.stringify(favorites));
    showFavorites();
  }
}

searchBtn.onclick = ()=> {
  const city = stateSelect.value;
  if(city) fetchWeather(city);
};

autoLocBtn.onclick = ()=>{
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(async pos=>{
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      try{
        let res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
        let data = await res.json();
        fetchWeather(data.name);
      } catch(err){ alert('Error fetching location weather'); }
    });
  } else { alert('Geolocation not supported'); }
};

stopVoiceBtn.onclick = stopVoice;

showFavorites();
</script>
</body>
</html>
